// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // Use environment variable for security; avoid hardcoding credentials
}

// Enums for better type safety and constraints
enum ProjectCategory {
  WEB_DEVELOPMENT
  BRANDING
  ADS
  OTHER
}

enum TestimonialCategory {
  BRANDING
  WEB_DEVELOPMENT
  ADS
  OTHER
}

enum UserRole {
  ADMIN
  EDITOR
  VIEWER
}

enum ServiceCategory {
  WEB_DEVELOPMENT
  BRANDING
  ADS
  MARKETING
  OTHER
}

enum PackageCategory {
  BASIC
  STANDARD
  PREMIUM
  CUSTOM
}

enum FAQCategory {
  GENERAL
  SERVICES
  PRICING
  PROJECTS
  OTHER
}

enum Currency {
  SAR // Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ
  USD
  EUR
  OTHER
}

// Ø¬Ø¯ÙˆÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
model Contact {
  id           String     @id @default(cuid())
  fullName     String     @map("full_name")
  email        String     @unique
  phone        String
  countryCode  String     @default("+20") @map("country_code")
  service      String?    // Could be enum if services are limited, but kept as String for flexibility
  budget       String?
  message      String?
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")

  @@index([email]) // Index for faster lookups
  @@map("contacts")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ - Improved relations and normalized some JSON fields
model Project {
  id          String       @id @default(cuid())
  title       String
  category    ProjectCategory
  type        String?
  image       String?
  thumbnail   String?
  badge       String?
  liveUrl     String?      @map("live_url")
  description String?
  featured    Boolean      @default(false)
  tag         String?
  challenge   String?
  solution    String?
  clientId    String?      @map("client_id") // Link to Client instead of JSON clientInfo
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª - Normalized
  client          Client?        @relation(fields: [clientId], references: [id], onDelete: SetNull)
  testimonials    Testimonial[]
  images          ProjectImage[]
  results         ProjectResult[]
  tools           ProjectTool[]
  galleryItems    GalleryItem[]
  relatedProjects RelatedProject[] @relation("ProjectToRelatedProjects")

  @@index([category, featured]) // Index for common queries
  @@map("projects")
}

// New model for Project Images (normalized from String[])
model ProjectImage {
  id        String   @id @default(cuid())
  projectId String   @map("project_id")
  url       String
  alt       String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_images")
}

// New model for Project Results (normalized from String[])
model ProjectResult {
  id        String   @id @default(cuid())
  projectId String   @map("project_id")
  result    String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_results")
}

// New model for Project Tools (normalized from String[])
model ProjectTool {
  id        String   @id @default(cuid())
  projectId String   @map("project_id")
  tool      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_tools")
}

// New model for Gallery Items (normalized from Json?)
model GalleryItem {
  id        String   @id @default(cuid())
  projectId String   @map("project_id")
  url       String
  type      String?  // e.g., image, video
  caption   String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("gallery_items")
}

// New model for Many-to-Many related projects (normalized from Json?)
model RelatedProject {
  id              String @id @default(cuid())
  projectId       String @map("project_id")
  relatedProjectId String @map("related_project_id")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  project         Project @relation("ProjectToRelatedProjects", fields: [projectId], references: [id], onDelete: Cascade)
  relatedProject  Project @relation("RelatedProjectsToProject", fields: [relatedProjectId], references: [id], onDelete: Cascade)

  @@unique([projectId, relatedProjectId]) // Prevent duplicates
  @@map("related_projects")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
model Client {
  id        String   @id @default(cuid())
  name      String   @unique // Unique names for clients
  country   String?
  flag      String?  @default("ğŸŒ")
  avatar    String?  @default("/images/placeholder-avatar.png")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  testimonials Testimonial[]
  projects     Project[]

  @@index([name]) // Index for lookups
  @@map("clients")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª
model Testimonial {
  id        String               @id @default(cuid())
  rating    Int                  @default(5)
  text      String
  projectId String?              @map("project_id")
  category  TestimonialCategory?
  clientId  String               @map("client_id")
  createdAt DateTime             @default(now()) @map("created_at")
  updatedAt DateTime             @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  client   Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project  Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  @@index([category, rating]) // Index for filtering
  @@map("testimonials")
}

// Ø¬Ø¯ÙˆÙ„ Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚ - Kept social as Json, but could normalize if needed
model TeamMember {
  id          String   @id @default(cuid())
  name        String
  position    String
  description String
  image       String
  social      Json?    // { "twitter": "...", "linkedin": "..." }
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("team_members")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚ÙŠÙ…
model Value {
  id          String   @id @default(cuid())
  icon        String
  title       String
  description String
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("values")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
model Stat {
  id        String   @id @default(cuid())
  number    Int
  label     String
  suffix    String   @default("")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("stats")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
model Service {
  id          String          @id @default(cuid())
  title       String
  description String
  price       String?
  category    ServiceCategory
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  @@index([category]) // Index for category-based queries
  @@map("services")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª - Normalized features if needed, but kept as array for simplicity
model Package {
  id          String          @id @default(cuid())
  category    PackageCategory
  title       String
  priceMin    Float?          @map("price_min")
  priceMax    Float?          @map("price_max")
  currency    Currency        @default(SAR)
  isMonthly   Boolean         @default(false) @map("is_monthly")
  description String?
  features    String[]        // Array of features
  popular     Boolean         @default(false)
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")

  @@index([category, popular]) // Index for filtering
  @@map("packages")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
model FAQ {
  id          String      @id @default(cuid())
  question    String
  answer      String
  category    FAQCategory
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")

  @@index([category]) // Index for category queries
  @@map("faqs")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù†Ø´Ø±Ø© Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©
model NewsletterSubscription {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([email]) // Index for uniqueness checks
  @@map("newsletter_subscriptions")
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String   // Remember to hash passwords in your application code
  role      UserRole @default(ADMIN)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  sessions     Session[]
  activityLogs ActivityLog[]

  @@index([email, role]) // Index for auth and role-based queries
  @@map("users")
}

// Ø¬Ø¯ÙˆÙ„ Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
model Session {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  createdAt DateTime @default(now()) @map("created_at")

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token, expiresAt]) // Index for session validation
  @@map("sessions")
}

// Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø£Ù†Ø´Ø·Ø© (Ù„Ù„ØªØªØ¨Ø¹)
model ActivityLog {
  id        String   @id @default(cuid())
  userId    String?  @map("user_id")
  action    String
  table     String
  recordId  String?  @map("record_id")
  oldData   Json?    @map("old_data")
  newData   Json?    @map("new_data")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")

  user   User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt(sort: Desc)]) // Index for recent logs per user
  @@map("activity_logs")
}